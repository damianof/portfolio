define(["knockout","jquery","Q"],function(t,e,n){var i=function(){t.command=function(e){var n=function(){return n.execute.apply(this,arguments)},i=e.canExecute,r=e.execute;return n.canExecute=t.computed(function(){return i?i():!0}),n.execute=function(t,e){return n.canExecute()?r.apply(this,[t,e]):void 0},n},t.promiseCommand=function(e){var i=e.canExecute,r=e.execute,a=function(){var t=a.execute.apply(this,arguments);return n.when(t).fail(function(){console.log("An error occured with execute delegate"),console.log(r)})};return a.isExecuting=t.observable(),a.canExecute=t.computed(function(){return i?i(a.isExecuting()):!a.isExecuting()}),a.execute=function(t,e){return a.canExecute()?(a.isExecuting(!0),n.fapply(r,[t,e]).then(function(){a.isExecuting(!1)}).done()):null},a},t.utils.wrapAccessor=function(t){return function(){return t}},t.bindingHandlers.command={init:function(e,n,i,r){var a=n(),o=a.execute?{click:a}:a,s=function(e){return void 0!==t.bindingHandlers[e]},c=function(){for(var n in o)s(n)&&t.bindingHandlers[n].init(e,t.utils.wrapAccessor(o[n].execute),i,r)},u=function(){var n={};for(var a in o)s(a)||(n[a]=o[a].execute);t.bindingHandlers.event.init(e,t.utils.wrapAccessor(n),i,r)};c(),u()},update:function(e,n,i,r){var a=n(),o=a.canExecute;if(!o)for(var s in a)if(a[s].canExecute){o=a[s].canExecute;break}o&&t.bindingHandlers.enable.update(e,o,i,r)}}};return{install:i}});