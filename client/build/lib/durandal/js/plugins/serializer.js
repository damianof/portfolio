define(["durandal/system"],function(t){return{typeAttribute:"type",space:void 0,replacer:function(t,e){if(t){var n=t[0];if("_"===n||"$"===n)return void 0}return e},serialize:function(e,n){return n=void 0===n?{}:n,(t.isString(n)||t.isNumber(n))&&(n={space:n}),JSON.stringify(e,n.replacer||this.replacer,n.space||this.space)},getTypeId:function(t){return t?t[this.typeAttribute]:void 0},typeMap:{},registerType:function(){var e=arguments[0];if(1==arguments.length){var n=e[this.typeAttribute]||t.getModuleId(e);this.typeMap[n]=e}else this.typeMap[e]=arguments[1]},reviver:function(t,e,n,i){var r=n(e);if(r){var o=i(r);if(o)return o.fromJSON?o.fromJSON(e):new o(e)}return e},deserialize:function(t,e){var n=this;e=e||{};var i=e.getTypeId||function(t){return n.getTypeId(t)},r=e.getConstructor||function(t){return n.typeMap[t]},o=e.reviver||function(t,e){return n.reviver(t,e,i,r)};return JSON.parse(t,o)}}});